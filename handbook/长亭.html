<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>phpMailer任意i代码执行漏洞分析过程</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/Hrgee/assets/css/0.styles.4f4d51f6.css" as="style"><link rel="preload" href="/Hrgee/assets/js/app.27d78a7b.js" as="script"><link rel="preload" href="/Hrgee/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/Hrgee/assets/js/22.9da5fa5c.js" as="script"><link rel="prefetch" href="/Hrgee/assets/js/10.7ccebb7c.js"><link rel="prefetch" href="/Hrgee/assets/js/11.33dcb92d.js"><link rel="prefetch" href="/Hrgee/assets/js/12.f1df6114.js"><link rel="prefetch" href="/Hrgee/assets/js/13.b59e04d3.js"><link rel="prefetch" href="/Hrgee/assets/js/14.4e4b238e.js"><link rel="prefetch" href="/Hrgee/assets/js/15.425f24f3.js"><link rel="prefetch" href="/Hrgee/assets/js/16.c0040550.js"><link rel="prefetch" href="/Hrgee/assets/js/17.f2889cf9.js"><link rel="prefetch" href="/Hrgee/assets/js/18.b9dae3fb.js"><link rel="prefetch" href="/Hrgee/assets/js/19.f9ffe888.js"><link rel="prefetch" href="/Hrgee/assets/js/20.6803e588.js"><link rel="prefetch" href="/Hrgee/assets/js/21.3dd21fa9.js"><link rel="prefetch" href="/Hrgee/assets/js/3.d9b695e0.js"><link rel="prefetch" href="/Hrgee/assets/js/4.d12742be.js"><link rel="prefetch" href="/Hrgee/assets/js/5.216cae74.js"><link rel="prefetch" href="/Hrgee/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/Hrgee/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/Hrgee/assets/js/8.9031bae3.js"><link rel="prefetch" href="/Hrgee/assets/js/9.26d3d10e.js">
    <link rel="stylesheet" href="/Hrgee/assets/css/0.styles.4f4d51f6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Hrgee/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Hrgee/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Ling blog" class="dropdown-title"><span class="title">Ling blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Ling blog" class="mobile-dropdown-title"><span class="title">Ling blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Hgrre/Hrgee.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Hrgee/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Ling blog" class="dropdown-title"><span class="title">Ling blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Ling blog" class="mobile-dropdown-title"><span class="title">Ling blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Hgrre/Hrgee.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/Hrgee/" class="sidebar-heading clickable router-link-active open"><span>欢迎学习</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Hrgee/" aria-current="page" class="sidebar-link">博客介绍</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/图片隐写" class="sidebar-heading clickable"><span>CTF-WP</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/Python笔记" class="sidebar-heading clickable"><span>Python基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/Linux笔记" class="sidebar-heading clickable"><span>Linux基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/sql" class="sidebar-heading clickable"><span>渗透</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/C笔记" class="sidebar-heading clickable"><span>逆向</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/NA" class="sidebar-heading clickable"><span>网络通讯基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/windows" class="sidebar-heading clickable"><span>操作系统</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/JS" class="sidebar-heading clickable"><span>Web渗透</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Hrgee/handbook/web" class="sidebar-heading clickable"><span>Web</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="phpmailer任意i代码执行漏洞分析过程"><a href="#phpmailer任意i代码执行漏洞分析过程" class="header-anchor">#</a> phpMailer任意i代码执行漏洞分析过程</h2> <ul><li>1：查找漏洞点（<code>$params</code> , 会被攻击手控制了，所以可以写入任何文件）</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091946901.webp" alt="Img"></p> <ul><li>2：函数朔源，找到过滤点（去看函数的回溯看它调用了哪些参数或数据）</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091947242.webp" alt="Img"></p> <ul><li>3.分析正则表达式(过滤点) 绕过方法</li> <li>4.手工调试正则表达式</li></ul> <h2 id="查缺补漏"><a href="#查缺补漏" class="header-anchor">#</a> 查缺补漏</h2> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091947789.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091947773.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091947475.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091948917.webp" alt="Img"></p> <h1 id="sql注入"><a href="#sql注入" class="header-anchor">#</a> sql注入</h1> <ul><li>反向查找
1.通过可控变量(也就是输入点)回溯危险函数
2.查找危险函数确定可控变量
3.传递的过程中触发漏洞</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091948452.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091948237.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091948915.webp" alt="Img"></p> <h2 id="反向漏洞挖掘特点"><a href="#反向漏洞挖掘特点" class="header-anchor">#</a> 反向漏洞挖掘特点</h2> <ul><li>根源：危险函数导致的漏洞</li> <li>特点：
1.暴力:全局搜索危险函数
2.简单：无需过多理解目标网站功能与架构
3.快速：适用于自动化代码审计工具
4.命中率低：简单的漏洞越来越少
5.无法挖掘逻辑漏洞：逻辑漏洞多数不存在危险函数，或危险函数的参数
6.适用性较差：不适合存在全局过滤的站点</li></ul> <h2 id="正向漏洞挖掘特点"><a href="#正向漏洞挖掘特点" class="header-anchor">#</a> 正向漏洞挖掘特点</h2> <ul><li>正向查找流程</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091949449.webp" alt="Img"></p> <ul><li>根源：程序员疏忽或逻辑问题导致漏洞</li> <li>特点：
1.复杂：需要及其了解目标源码的功能与架构
2.跳跃性大：涉及M/V/C/Service/Dao等多个层面
3.漏洞的组合：通常是多个漏洞的组合，很可能存在逻辑相关的漏洞
4.潜力无限：安全研究人员的宝库</li></ul> <h2 id="双向漏洞挖掘特点"><a href="#双向漏洞挖掘特点" class="header-anchor">#</a> 双向漏洞挖掘特点</h2> <ul><li>根源：理解程序执行过程，寻找危险逻辑</li> <li>特点：
1.高校：如挖掘隧道，双向开工，时间减半
2.知识面广：需要同时掌握正向，反向挖掘技巧，并进行结合，以及所有正向，反向的优点</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091949912.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091949632.webp" alt="Img"></p> <h1 id="技巧"><a href="#技巧" class="header-anchor">#</a> 技巧</h1> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091949750.webp" alt="Img"></p> <ul><li>(intval) 这个函数是将用户输入的内容转换成数字类型的变量</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091950753.webp" alt="Img"></p> <ul><li>这是转换后的数据</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091950380.webp" alt="Img"></p> <ul><li>(addslashes) 这个函数是将用户的输入进行一个转义。也会存在宽字符注入</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091950939.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091951022.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091951281.webp" alt="Img"></p> <ul><li>这是转义后的数据</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091951613.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091951795.webp" alt="Img"></p> <p>漏洞例子：</p> <ul><li>直接获取到get的变量里的name参数</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091952419.webp" alt="Img"></p> <ul><li>(htmlspecialchars) 函数</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091952905.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091952511.webp" alt="Img"></p> <ul><li>用户输入你即使用了 addslashes() 这个函数，对用户进行了转义,但是在拼接语句的时候没有使用(' 单引号) 它任然无法访问sql漏洞的</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091953959.webp" alt="Img"></p> <ul><li>(str_replace) 函数</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091953368.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091953939.webp" alt="Img"></p> <ul><li>(is_numeric) 函数</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091953576.webp" alt="Img"></p> <ul><li>(header) 函数会给用户返回一个页面，并没有阻止这个php继续运行，虽然判断了这个是不是数字，虽然进行了404页面这个返回，但是并没有停止这个页面的执行，也就导致后面这个sql语句仍然被执行</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091954504.webp" alt="Img"></p> <h2 id="任意文件操作"><a href="#任意文件操作" class="header-anchor">#</a> 任意文件操作</h2> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091954825.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091954752.webp" alt="Img"></p> <h2 id="php命令执行"><a href="#php命令执行" class="header-anchor">#</a> PHP命令执行</h2> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091954431.webp" alt="Img"></p> <ul><li>如何防御PHP的命令注入漏洞：可能需要设置白名单，去过滤掉用户输入的注入字符
1：首先黑白名单究竟在限制什么，</li></ul> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091954468.webp" alt="Img"></p> <p><img src="https://rtyu-1317440738.cos.ap-guangzhou.myqcloud.com/202305091955680.webp" alt="Img"></p> <p>123123wdwd</p> <p>adwdwd</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Hrgee/assets/js/app.27d78a7b.js" defer></script><script src="/Hrgee/assets/js/2.733019b2.js" defer></script><script src="/Hrgee/assets/js/22.9da5fa5c.js" defer></script>
  </body>
</html>
